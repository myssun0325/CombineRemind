# 2. Publishers & Subscribers

## Hello Publisher

At the heart of Combine is theÂ `Publisher`Â protocol. This protocol defines the requirements for a type to be able to transmit a sequence of values over time to one or more subscribers. In other words, a publisher publishes or emits events that can include values of interest.

- 1ê°œ ì´ìƒì˜ subscriberì—ê²Œ ê°’ì„ ë°©ì¶œí•  ìˆ˜ ìˆìŒ.

ex) NotificationCenterê°€ì§€ê³  publisher ë§Œë“¤ê¸°

```swift
let myNotification = Notification.Name("MyNotification")

let publisher = NotificationCenter.default
	.publisher(for: myNotification, object: nil)
```

## Hello Subscriber

`Subscriber`Â is a protocol that defines the requirements for a type to be able to receive input from a publisher.

```swift
let myNotification = Notification.Name("MyNotification")
let center = NotificationCenter.default

let publisher = center.publisher(for: myNotification, object: nil)

let subscription = publisher
    .sink { _ in
        print("Notification received")
    }

center.post(name: myNotification, object: nil)
subscription.cancel()
```

- sinkëŠ” 2ê°œì˜ í´ë¡œì € ì œê³µ: valueì™€ completion event ì²˜ë¦¬

![Untitled](2%20Publishers%20&%20Subscribers%2001b3bb3491214d668f887d2466e19d72/Untitled.png)

- Completionì€ ì•„ë˜ì™€ ê°™ì´ finished, failure ë‘˜ ì¤‘ì— í•˜ë‚˜ë¡œ ëë‚¨.

![Untitled](2%20Publishers%20&%20Subscribers%2001b3bb3491214d668f887d2466e19d72/Untitled%201.png)

- publisherê°€ never failì´ë©´ ì‚¬ìš©í•˜ëŠ” sinkë„ ìˆìŒ. (`Self.Failure == Never`) ìœ„ì˜ ê²½ìš°ì™€ ë‹¤ë¥´ê²Œ receiveCompletion íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ë²„ì „.

![Untitled](2%20Publishers%20&%20Subscribers%2001b3bb3491214d668f887d2466e19d72/Untitled%202.png)

## Republishing with `assign(to:)`

- assignì—ë„ ë‘ê°€ì§€ ë©”ì„œë“œê°€ ìˆìŒ
- `**assign(to:)` ì˜¤í¼ë ˆì´í„°ëŠ” AnyCancellableì„ ë°˜í™˜í•˜ì§€ ì•ŠìŒ.**
    - It manages the lifecycle internally and cancels the subscription when the `@Published` property deinitializes.
    @Published í”„ë¡œí¼í‹°ê°€ Deinit ë  ë•Œ êµ¬ë…ì„ cancelí•œë‹¤.

![Untitled](2%20Publishers%20&%20Subscribers%2001b3bb3491214d668f887d2466e19d72/Untitled%203.png)

```swift
example(of: "assign(to:)") {
  class SomeObject {
    @Published var value = 0
  }
  
  let object = SomeObject()
  
  object.$value
    .sink {
      print($0)
    }
  
  (0..<10).publisher
    .assign(to: &object.$value)
}
```

## sinkë©”ì„œë“œì˜ ë©”ì„œë“œ ìë™ì™„ì„± ì¶”ë¡ 

- sinkë©”ì„œë“œê°€ publisherì˜ Failure íƒ€ì…ì„ ë³´ê³  Neverë©´ `.sink(receiveValue:)` ë©”ì„œë“œë„ ìë™ìœ¼ë¡œ ì¶”ì²œí•´ì¤Œ â†’ Neverê°€ ì•„ë‹ˆë©´ `.sink(receiveCompletion:,receiveValue:)` ë§Œ ì¶”ì²œí•´ì¤Œ.

## Just

- Failure == Never

## Future

[https://developer.apple.com/documentation/combine/future](https://developer.apple.com/documentation/combine/future)

**single valueì™€ finishë¥¼ ë°©ì¶œí•˜ê±°ë‚˜ fails**

- Outputê³¼ Errorë¥¼ ê°€ì§€ê³  ìˆìŒ
- Promise Closure = `(Result<Output, Failure>) -> Void`
- Resultì˜ successë‚˜ failureê°€ íë¥´ë©´ ë°”ë¡œ êµ¬ë…ì´ ì·¨ì†Œëœë‹¤.
    - success â†’ value í•œ ë²ˆ ë°©ì¶œí›„ finish ë°©ì¶œ
    - failure â†’ failure ë°©ì¶œ
- Rxì˜ Singleì´ë‘ ë¹„ìŠ¤ë¬´ë¦¬.  (Single = Deferred + Future)

```swift
// 1.
func myFuture() -> Future<Int, Never> {
    return Future { promise in
        promise(.success(5))
        promise(.success(4)) // ë’¤ì—ê»€ ë¬´ì‹œë¨
    }
}

myFuture()
    .sink(receiveCompletion: { print($0) },
          receiveValue: { print($0) })
// Output
// 5 - valueí´ë¡œì €
// finished - completion í´ë¡œì €

// 2.
enum MyError: Error {
    case new
}

func myFuture() -> Future<Int, MyError> {
        return Future { promise in
            promise(.failure(.new))
            promise(.success(5))
            promise(.success(4))
        }
    }

myFuture()
    .sink(receiveCompletion: { print($0) },
          receiveValue: { print($0) })

// Output
// failure(MyError.new) - completion í´ë¡œì €

// ê³µì‹ì˜ˆì œ
func generateAsyncRandomNumberFromFuture() -> Future <Int, Never> {
    return Future() { promise in
        DispatchQueue.main.asyncAfter(deadline: .now() + 2) {
            let number = Int.random(in: 1...10)
            promise(Result.success(number))
        }
    }
}
```

## Hello Cancellable

êµ¬ë…ì€ AnyCancellable ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë¦¬í„´í•¨(â€cancellation tokenâ€)

AnyCancellableì€ Cancellable í”„ë¡œí† ì½œì„ ì±„íƒí•¨.(cancel() ë©”ì„œë“œë¥¼ ìš”êµ¬í•˜ëŠ” í”„ë¡œí† ì½œ)

Subscription í”„ë¡œí† ì½œì€ Cancellableì„ ìƒì†ë°›ì•˜ê¸° ë•Œë¬¸ì— cancel() ë©”ì„œë“œ í˜¸ì¶œì´ ê°€ëŠ¥í•¨

```swift
public protocol Subscription : Cancellable, 
CustomCombineIdentifierConvertible {
    /// Tells a publisher that it may send more values to the subscriber.
    func request(_ demand: Subscribers.Demand)
}

public protocol Cancellable { 
 func cancel()
}
```

- subscription scope
    - `_ = just.sink...`
    - subscriptionì„ ìœ„ì™€ ê°™ì´ ë¬´ì‹œí•˜ë©´ ë°”ë¡œ êµ¬ë…ì´ ë˜ê³ ë‚˜ì„œ ë°”ë¡œ cancel
    - ë³€ìˆ˜ì— ì €ì¥í•˜ë©´ ë³€ìˆ˜ì˜ lifecycleì´ scope
    

## Understanding whatâ€™s going on

![Untitled](2%20Publishers%20&%20Subscribers%2001b3bb3491214d668f887d2466e19d72/Untitled%204.png)

1. Subscriberê°€ Publisherë¥¼ êµ¬ë…í•¨.  - subscribe
2. publisherê°€ subscriptionì„ createí•˜ê³  subscriberí•œí…Œ ì¤Œ - gives subscription
3. subscriberê°€ valueë¥¼ ìš”ì²­í•¨ - requests values
4. publisherê°€ valueë¥¼ ë³´ëƒ„ - sends values
5. publisherê°€ completionì„ ë³´ëƒ„ - sends completion

## Publisher

```swift
public protocol Publisher {
  // 1
  associatedtype Output

  // 2
  associatedtype Failure : Error

  // 4
  func receive<S>(subscriber: S)
    where S: Subscriber,
    Self.Failure == S.Failure,
    Self.Output == S.Input
}

extension Publisher {
  // 3
  public func subscribe<S>(_ subscriber: S)
    where S : Subscriber,
    Self.Failure == S.Failure,
    Self.Output == S.Input
}
```

1. publisherê°€ ë°©ì¶œí•  ìˆ˜ ìˆëŠ” ê°’ì˜ íƒ€ì…
2. publisherê°€ ì—ëŸ¬ë¥¼ ë°©ì¶œí–ˆì„ ë•Œì˜ íƒ€ì…, Never â†’ ì—ëŸ¬ë¥¼ ë°©ì¶œí•˜ì§€ ì•ŠìŒ
3. subscriberê°€ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ
4. 3ë©”ì„œë“œì¸ subscribe(_:)ë©”ì„œë“œì˜ êµ¬í˜„ì´ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ subscribeë©”ì„œë“œì—ì„œ receiveë¥¼ í˜¸ì¶œí•´ì„œ subscriberë¥¼ publisherì— ì—°ê²°í•œë‹¤ â†’ ì¦‰, `subscription`ì„ ìƒì„±

Publisherì˜ êµ¬ë…(subscription)ì„ ìƒì„±í•˜ê¸° ìœ„í•´ì„œ associated typeì€ Subscriberì˜ associated typeê³¼ ë°˜ë“œì‹œ ë§¤ì¹­ë˜ì•¼í•¨.

## Subscriber

```swift
public protocol Subscriber: CustomCombineIdentifierConvertible {
  // 1
  associatedtype Input

  // 2
  associatedtype Failure: Error

  // 3
  func receive(subscription: Subscription)

  // 4
  func receive(_ input: Self.Input) -> Subscribers.Demand

  // 5
  func receive(completion: Subscribers.Completion<Self.Failure>)
}
```

1. subscriberê°€ ë°›ì„ ìˆ˜ ìˆëŠ” value íƒ€ì…
2. subscriberê°€ ë°›ì„ ìˆ˜ ìˆëŠ” errro íƒ€ì…. NeverëŠ” errorë¥¼ ë°›ì§€ ì•ŠëŠ”ë‹¤.
3. publisherê°€ í˜¸ì¶œí•˜ê²Œ ë˜ëŠ” ë©”ì„œë“œ. publisherê°€ subscriptionì„ ì „ë‹¬í•´ì£¼ëŠ” ë©”ì„œë“œ
4. publisherê°€ subscriberì—ê²Œ ê°’ì„ ë³´ë‚¼ ë•Œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ
5. publisherê°€ subscriberì—ê²Œ completionì„ ë³´ë‚¼ ë•Œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ

## Subscription

```swift
public protocol Subscription: Cancellable, 
CustomCombineIdentifierConvertible {
  func request(_ demand: Subscribers.Demand)
}
```

- subscriberê°€ Subscriptionì˜ requestë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤. request ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ max number ë‚˜ unlimitedê¹Œì§€ ê°’ì„ ë” ë°›ì„ì§€ë§ì§€ ìš”ì²­í•œë‹¤.
    
    â†’ subscriberê°€ ê°’ì„ ì–¼ë§ˆë‚˜ ë°›ì„ì§€ : backpressure
    

> subscriberê°€ ì–¼ë§ˆë‚˜ ë§ì€ ê°’ì„ ë°›ì„ì§€ ì¡°ì •(stating)í•˜ëŠ” ê°œë…ì€Â **backpressure management**ë¼ê³  ì•Œë ¤ì ¸ìˆë‹¤. ì´ëŸ° ì „ëµì„ ì•ˆì“°ë©´ subscriberê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ê²ƒë³´ë‹¤ publisherë¡œë¶€í„° ë§ì€ ê°’ì„ ë°›ê²Œ ë˜ë©´ flow ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤. BackpressureëŠ” 18ì¥ì—ì„œ ë‹¤ë£° ì˜ˆì •.
> 
- Subscriberì˜ receive(_:) ë©”ì„œë“œëŠ” Demandë¥¼ ë¦¬í„´í•œë‹¤.  subscription.requestë©”ì„œë“œë¥¼ í†µí•´ ìµœì´ˆì— subscriberê°€ ê°’ì„ ì–¼ë§ˆë‚˜ ë°›ì„ì§€ ì„¤ì •í•´ë„, ìƒˆ ê°’ì„ ë°›ì„ ë•Œë§ˆë‹¤ maxê°’ì„ ì¡°ì •í•  ìˆ˜ ìˆìŒ

> Subscriber.receive(_:) ë©”ì„œë“œ ì•ˆì—ì„œ `max` ê°’ì„ ì¡°ì ˆí•˜ëŠ” ê²ƒì€ `ì¶”ê°€`ë¥¼ í•˜ëŠ” ê²ƒì´ë‹¤. receive ë©”ì„œë“œì•ˆì—ì„œ maxë¥¼ ì¡°ì ˆí•˜ë©´ í˜„ì¬ maxê°’ì— ì¡°ì •í•œ maxê°’ì´ ë”í•´ì§„ë‹¤. max ê°’ì€ ì–‘ìˆ˜ì—¬ì•¼í•œë‹¤. ìŒìˆ˜ë©´ fatalErrorê°€ ë°œìƒí•œë‹¤. â†’ max valueì˜ ì¦ê°€ì‹œí‚¬ ìˆ˜ë§Œ ìˆìŒì„ ì˜ë¯¸.
> 

### Custom Subscriber ë§Œë“¤ì–´ë³´ê¸° (adjust max value)

- requestë¥¼ max(3)ìœ¼ë¡œ í–ˆê¸° ë•Œë¬¸ì— completionì´ë²¤íŠ¸ë¥¼ ë°›ì§€ ëª»í•œë‹¤. (Publisiherê°€ 6ê°œì˜ ê°’ì„ ë°©ì¶œí•˜ë”ë¼ë„)
- receiveë©”ì„œë“œì—ì„œ Demandë¥¼ `.unlimited` ë¡œ ë°”ê¾¸ë©´ 6ê°œë¥¼ ë‹¤ ë°›ê³  completionì„ ë°›ì„ ìˆ˜ ìˆë‹¤. ìœ„ì—ì„œ ë§í•œ receiveë©”ì„œë“œì—ì„œ max ê°’ì„ ì¡°ì ˆí•˜ëŠ”ê±¸ ì•Œ ìˆ˜ ìˆë‹¤.
- `.unlimited` ëŒ€ì‹  `.max(1)`ë¡œ ë°”ê¿”ë„ ê²°ê³¼ëŠ” unlimitedë‘ ê°™ë‹¤. â†’ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ë•Œë§ˆë‹¤ maxë¥¼ 1ì”© ì¶”ê°€í•˜ëŠ” íš¨ê³¼

```swift
func customSubscriber() {
    let publisher = (1...6).publisher
    let subscriber = IntSubscriber()
    publisher.subscribe(subscriber)
}
    
final class IntSubscriber: Subscriber {
    typealias Input = Int
    typealias Failure = Never
    
    func receive(subscription: Subscription) {
        print("MasonğŸğŸğŸ: \(#function)")
        subscription.request(.max(3))
    }
    
    func receive(_ input: Int) -> Subscribers.Demand {
        print("MasonğŸğŸğŸ: Received value: \(input)")
        return .none
    }
    
    func receive(completion: Subscribers.Completion<Never>) {
        print("MasonğŸğŸğŸ: Received completion: \(completion)")
    }
}

// Output
// MasonğŸğŸğŸ: receive(subscription:)
// MasonğŸğŸğŸ: Received value: 1
// MasonğŸğŸğŸ: Received value: 2
// MasonğŸğŸğŸ: Received value: 3

/*
Demandë¥¼ ë°”ê¾¼ ê²½ìš°
*/
func receive(_ input: Int) -> Subscribers.Demand {
    print("MasonğŸğŸğŸ: Received value: \(input)")
    return .unlimited // same as .max(1)
}

/*
MasonğŸğŸğŸ: receive(subscription:)
MasonğŸğŸğŸ: Received value: 1
MasonğŸğŸğŸ: Received value: 2
MasonğŸğŸğŸ: Received value: 3
MasonğŸğŸğŸ: Received value: 4
MasonğŸğŸğŸ: Received value: 5
MasonğŸğŸğŸ: Received value: 6
MasonğŸğŸğŸ: Received completion: finished
*/
```

- Just â†” Future
    - FutureëŠ” justì²˜ëŸ¼ ì¦‰ì‹œ single valueë¥¼ ë°©ì¶œí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ asynchronously í•˜ê²Œ single resultë¥¼ ë°©ì¶œí•˜ê³  complete.
    

## Hello Future

```swift
final public class Future<Output, Failure> : Publisher
  where Failure: Error {
  public typealias Promise = (Result<Output, Failure>) -> Void
  ...
}
```

```swift
func futureIncrement(
        integer: Int,
        afterDelay delay: TimeInterval
    ) -> Future<Int, Never> {
    return Future { promise in
        DispatchQueue.global().asyncAfter(deadline: .now() + delay) {
            promise(.success(integer + 1))
        }
    }
}

let future = futureIncrement(integer: 1, afterDelay: 3)
        
future
  .sink(receiveCompletion: { print($0) },
        receiveValue: { print($0) })

// Output
// 2
// finished
```

- FutureëŠ” promiseë¥¼ ì¬ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. it shares or replays its output.
    - Originalì´ í•œ ë²ˆë§Œ ì°íˆê³  ë‘ë²ˆì§¸ êµ¬ë…ì— ìˆì–´ì„  valueì™€ completionë§Œ ë°©ì¶œ
    - `attemptToFulfill` í´ë¡œì €ê°€ í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤.
    - â€˜Originalâ€™ì€ êµ¬ë…(Subscription)ì´ ë°œìƒí•˜ê¸° ì§ì „ì— ì‹¤í–‰ëœë‹¤.
    - `future` is greedy. â†” regular publishers are lazy.
    greedy = executes as soon as itâ€™s created. not deferred.
        
        â†’ FutureëŠ” subscriberê°€ ìˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ìƒì„±ë˜ì—ˆì„ ë•Œ ì‹¤í–‰ëœë‹¤. ë°˜ëŒ€ë¡œ lazyëŠ” ì‹¤ì œ êµ¬ë…ì´ ìˆì„ ë•Œ ì‹¤í–‰ëœë‹¤.
        

```swift
func futureIncrement(
        integer: Int,
        afterDelay delay: TimeInterval
    ) -> Future<Int, Never> {
    return Future { promise in
        print("Original")
        DispatchQueue.global().asyncAfter(deadline: .now() + delay) {
            promise(.success(integer + 1))
        }
    }
}

let future = futureIncrement(integer: 1, afterDelay: 3)
        
future
    .sink(receiveCompletion: { print($0) },
          receiveValue: { print($0) })
    .store(in: &cancellables)

future
  .sink(receiveCompletion: { print("Second", $0) },
        receiveValue: { print("Second", $0) })
  .store(in: &cancellables)

// Output
/*
Original
2
finished
Second 2
Second finished

Second2 Second finishedê°€ ë¨¼ì € ì˜¬ ìˆ˜ ìˆìŒ. ê¸€ë¡œë²Œíë¼ì„œ.
*/
```

## Hello Subject

### PassthroughSubject

- completionì´ ì´ë¯¸ íë¥¸ subjectë¥¼ êµ¬ë…í•œ ê²½ìš° êµ¬ë…ì‹œ completionì´ ì˜¨ë‹¤.

```swift
example(of: "PassthroughSubject") {
  enum MyError: Error {
    case test
  }
  
  final class StringSubscriber: Subscriber {
    typealias Input = String
    typealias Failure = MyError
    
    func receive(subscription: Subscription) {
      subscription.request(.max(2))
    }
    
    func receive(_ input: String) -> Subscribers.Demand {
      print("Received value", input)
      // 3
      return input == "World" ? .max(1) : .none
    }
    
    func receive(completion: Subscribers.Completion<MyError>) {
      print("Received completion", completion)
    }
  }
  let subscriber = StringSubscriber()
}

// 5
let subject = PassthroughSubject<String, MyError>()

// 6
subject.subscribe(subscriber)

// 7
let subscription = subject
  .sink(
    receiveCompletion: { completion in
      print("Received completion (sink)", completion)
    },
    receiveValue: { value in
      print("Received value (sink)", value)
    }
  )

subject.send("Hello")
subject.send("World")
/*
Output
-------
Received value Hello
Received value (sink) Hello
Received value World
Received value (sink) World
*/

// 8
subscription.cancel()

// 9
subject.send("Still there?")

/*
Output
-------
Received value Hello
Received value (sink) Hello
Received value World
Received value (sink) World
Received value Still there?
*/

// 10
subject.send(completion: .finished)
subject.send("How about another one?")
```

1. Subscribes the subscriber to the subject

 8. (7)ë²ˆì˜ êµ¬ë…ì„ ì·¨ì†Œí–ˆë‹¤. (9)ë²ˆì˜ subjectì— ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ë„ (7)ì—ì„œëŠ” ë°›ì„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— (6)ì˜ êµ¬ë…ë§Œ ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

1. completionì„ ë³´ëƒˆê¸° ë•Œë¬¸ì— ê·¸ ë’¤ì— subjectì— ê°’ì„ ë³´ë‚´ë„ (6)ì—ì„œë„ ê°’ì„ ëª»ë°›ìŒ.

### CurrentValueSubject

- êµ¬ë… ì‹œ í˜„ì¬(ìµœì‹ ì˜) ê°’ì„ ë°©ì¶œí•œë‹¤.
- `value` í”„ë¡œí¼í‹°ë¡œ ë§ˆì§€ë§‰ìœ¼ë¡œ sendí•œ ê°’ì„ êº¼ë‚´ì˜¬ ìˆ˜ ìˆë‹¤. (subjectê°€ completion, failureë¥¼ ë³´ë‚¸ê²ƒê³¼ ìƒê´€ì—†ìŒ. êµ¬ë…ì˜ í”„ë¡œí¼í‹°ê°€ ì•„ë‹ˆë¼ subject ìì²´ì˜ í”„ë¡œí¼í‹°ê¸° ë•Œë¬¸)
    - sendë©”ì„œë“œë¥¼ ì“°ì§€ì•Šê³  valueê°€ getter setterê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ ê°’ì„ í• ë‹¹í•´ë„ sendë³´ë‚¸ê²ƒê³¼ ê°™ì€ íš¨ê³¼ `currentValueSubject.value = 3`
    

## Dynamically adjusting demand

- receiveì—ì„œ Demand Custom
- ì˜ˆì œì—ì„œ ì´ 5ì´ê¸° ë•Œë¬¸ì— ë‹¤ì„¯ê°œë§Œ ë°›ëŠ”ë‹¤.

```swift
final class IntSubscriber: Subscriber {
typealias Input = Int
typealias Failure = Never

	func receive(subscription: Subscription) {
	    subscription.request(.max(2))
	}
	
	func receive(_ input: Int) -> Subscribers.Demand {
	    print("Received value", input)
	    
	    switch input {
	    case 1:
	        return .max(2)
	    case 3:
	        return .max(1)
	    default:
	        return .none
	    }
	}
	
	func receive(completion: Subscribers.Completion<Never>) {
	    print("Received completion", completion)
	}
}

let subscriber = IntSubscriber()

let subject = PassthroughSubject<Int, Never>()

subject.subscribe(subscriber)

subject.send(1) // 2 + 2  (max2)
subject.send(2) // 4 (none)
subject.send(3) // 4 + 1 (max1)
subject.send(4) // 5 (none)
subject.send(5) // 5 (none)
subject.send(6) // 5 (none)

/*
Output
------
Received value 1
Received value 2
Received value 3
Received value 4
Received value 5
*/
```

## Type erasure

publisherê°€ subscriberí•œí…Œ ë””í…Œì¼ì„ ìˆ¨ê¸°ê³ ì í•  ë•Œ.

- `AnyPublisher`
    - Publisher í”„ë¡œí† ì½œì„ ì±„íƒí•œ type-erased struct.
    - send ì˜¤í¼ë ˆì´í„°ê°€ ì—†ìŒ.
- `AnyCancellable`
    - type-erased class that conforms to `Cancellable`. (cancellableì€callerê°€ underlying subscriptionì— ì ‘ê·¼í•˜ì§€ ì•Šê³ ë„ callerì˜ subscriptionì„ ì·¨ì†Œí•  ìˆ˜ ìˆì—ˆë‹¤.)

ex) publisherì˜ type erasureë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ê²½ìš°

- publicê³¼ private í”„ë¡œí¼í‹°ê°€ ìŒì„ ì´ë¤„ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê²½ìš°. private í”„ë¡œí¼í‹°ì— ê°’ì„ ì „ì†¡í•˜ê³  ì™¸ë¶€ì—ì„  public í”„ë¡œí¼í‹°ë¥¼ í†µí•´ êµ¬ë…ë§Œ í•  ìˆ˜ ìˆê³  ê°’ì„ ì™¸ë¶€ì—ì„  ë‚´ë¶€ë¡œ sendí•  ìˆ˜ ì—†ëŠ” ê²½ìš°. = Rxì—ì„œ ë‚´ë¶€ì—ì„  subjectì™¸ë¶€ì—ì„  observableë¡œ ì“°ëŠ” ê²½ìš°ì™€ ê°™ë‹¤.

## Swift5.5 + iOS15 = async/await + Combine

- values í”„ë¡œí¼í‹° : AsyncPublisher

![Untitled](2%20Publishers%20&%20Subscribers%2001b3bb3491214d668f887d2466e19d72/Untitled%205.png)

```swift
Task {
	for await element in 
}
```