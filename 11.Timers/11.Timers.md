# 11.Timers

## Using RunLoop

ìŠ¤ë ˆë“œëŠ” ê°ê° RunLoopë¥¼ ê°€ì§. í˜„ì¬ ìŠ¤ë ˆë“œì—ì„œ `RunLoop.current` í˜¸ì¶œì„ í†µí•´ RunLoopë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.(Foundationì´ í•„ìš”í•œ ê²½ìš° ìë™ìœ¼ë¡œ RunLoopë¥¼ ìƒì„±í•´ì¤€ë‹¤. ëŸ°ë£¨í”„ì— ëŒ€í•œ ì´í•´ê°€ ì—†ë‹¤ë©´ Main RunLoopë¥¼ ì‚¬ìš©í•˜ì)

(ì§€ê¸ˆì€ RunLoop ìì²´ê°€ ì£¼ìš” ì£¼ì œê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— RunLoopì— ëŒ€í•œ ì„¤ëª…ì€ ìŠ¤í‚µí•œë‹¤. ì°¸ê³ ë¡œ ëŸ°ë£¨í”„ëŠ” ìŠ¤ë ˆë“œ ì„¸ìœ¼í”¼í•˜ì§€ ì•Šë‹¤. ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ì¤‘ì¸ RunLoopê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì§€ì•Šì„ê²ƒ. í˜„ì¬ ìŠ¤ë ˆë“œì˜ ëŸ°ë£¨í”„ì— ëŒ€í•´ì„œë§Œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.)

[https://developer.apple.com/documentation/foundation/runloop](https://developer.apple.com/documentation/foundation/runloop)

### RunLoop

- publisherë¥¼ ë§Œë“¤ì§€ ì•ŠìŒ. Cancellableì„ ë§Œë“¬
- ì‹¬í”Œí•˜ê²Œ Cancellableì„ í†µí•´ cancelí•  ìˆ˜ ìˆëŠ” ê²ƒë§ê³¤ ìœ ìš©ì„±ì€ ë–¨ì–´ì§„ë‹¤.
- ì˜ˆì œì½”ë“œ
    
    ```swift
    let runLoop = RunLoop.main
    
    let subscription = runLoop.schedule(
      after: runLoop.now,
      interval: .seconds(1),
      tolerance: .milliseconds(100)
    ) {
      print("Timer fired")
    }
    ```
    
- RunLoopëŠ” Combineì˜ [Scheduler í”„ë¡œí† ì½œ](https://developer.apple.com/documentation/combine/scheduler)ì„ ì±„íƒí•˜ê³  ìˆë‹¤.
- ë©”ì„œë“œê°€ Cancellableì„ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŒ.

![Untitled](11%20Timers%20b401f752830a4b909b11c156ce3d8622/Untitled.png)

- Cancellableì„ í†µí•´ cancel()ë¡œ íƒ€ì´ë¨¸ ë©ˆì¶”ê¸°
    
    ```swift
    runLoop.schedule(after: .init(Date(timeIntervalSinceNow: 3.0))) {
      subscription.cancel()
    }
    ```
    
- **ëª¨ë“  ê²ƒì„ ê³ ë ¤í–ˆì„ ë•Œ RunLoopëŠ” íƒ€ì´ë¨¸ë¥¼ ìƒì„±í•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ ì•„ë‹˜. > Timer í´ë˜ìŠ¤ ì‚¬ìš©**

## Using the Timer class

### Timer

- TimerëŠ” ì´ˆê¸°ì§€ì—° â†’ ì½”ë“œì—ì„œ every: 1.0ì€ êµ¬ë…í•˜ê³  1ì´ˆ ì´í›„ë¶€í„° ê°’ì„ ë‚´ë¦¬ê¸° ì‹œì‘
- ê¸°ì¡´ Timer í´ë˜ìŠ¤ì˜ publisherë¥¼ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŒ. (Timer.TimerPublisher)

```swift
let publisher = Timer.publish(every: 1.0, on: .main, in: .common)
let publisher = Timer.publish(every: 1.0, on: .current, in: .common)
```

- TimerPublisherëŠ” ConnectablePublisherì´ë¯€ë¡œ connect()í˜¸ì¶œì´ í•„ìš”í•¨ (or autoconnect())
- Timerì˜ toleranceê°’ì´ ëŸ°ë£¨í”„ì˜ minimumToleranceë³´ë‹¤ ì‘ìœ¼ë©´ ì´ìƒí•œ ê²°ê³¼ë¥¼ ë‚³ì„ ìˆ˜ ìˆìŒ(TimerëŠ” RunLoopë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì¡´ì ìœ¼ë¡œ ì‘ë™í•¨)

## Using DispatchQueue

### DispatchQueue

- DispatchQueueë„ Scheduler í”„ë¡œí† ì½œì„ ì±„íƒí•˜ê³  ìˆìŒ.
- ì´ˆê¸°ì§€ì—°ì´ ì—†ìŒ. êµ¬ë…ì‹œ ë°”ë¡œ ê°’ì„ í˜ë¦¼ (Timerë‘ ë‹¤ë¦„)

```swift
let queue = DispatchQueue.main

// 1
let source = PassthroughSubject<Int, Never>()

// 2
var counter = 0

// 3  the action starts immediately
let cancellable = queue.schedule(
  after: queue.now,
  interval: .seconds(1)
) {
  source.send(counter)
  counter += 1
}

// 4
let subscription = source.sink {
  print("Timer emitted \($0)")
}
```

### Key points

- Create timers using good oldÂ `RunLoop`Â class if you have Objective-C code nostalgia. ğŸ¤·â€â™‚ï¸
- Timer.publishë¥¼ í†µí•´ íŠ¹ì • RunLoopì—ì„œ ì§€ì •ëœ ê°„ê²©ìœ¼ë¡œ ê°’ì„ ìƒì„±í•˜ëŠ” publisherë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ
- ê°€ì¥ ìµœì‹ íƒ€ì´ë¨¸ â†’ DispatchQueue.scheduleì„ í†µí•´ ë””ìŠ¤íŒ¨ì¹˜íì—ì„œ ì´ë²¤íŠ¸ë¥¼ ë³´ëƒ„.