# 5.Combining Operators

## Prepending

### prepend(Output)

- publisherì˜ ì‹œì‘ ì•ì— Outputì„ ì¶”ê°€í•´ì„œ ì‹œì‘í•œë‹¤. (rxì˜ startWith)
- Outputì€ ê°™ì€ íƒ€ì…ì´ì–´ì•¼ í•œë‹¤. ê°€ë³€ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ìŒ.
- **prependë¥¼ ë¶™ì—¬ì“¸ ê²½ìš° ë’¤ì— ì“´ prependì˜ Outputì´ ë¨¼ì € ì˜¨ë‹¤.**
- **ìŠ¤íŠ¸ë¦¼ì— ê°’ì´ íë¥´ì§€ ì•Šë”ë¼ë„ prependê°€ ë¶™ì–´ìˆëŠ” publisherë¥¼ êµ¬ë…í•˜ë©´ prepend outputë¡œ ì‹œì‘**
    
    ```swift
    [6,5].publisher
    .prepend(1, 2)
    .prepend(3, 4)
    /*
    3
    4
    1
    2
    5
    6
    */
    
    let subject = PassthroughSubject<Int, Never>()
    subject
      .prepend(1,2)
      .prepend(3)
      .sink(receiveValue: {print($0) })
      .store(in: &subscriptions)
    // 3
    // 1
    // 2
    ```
    

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled.png)

### prepend(Sequence)

- ìœ„ì˜ prependì—ì„œ Sequenceë¥¼ ë°›ëŠ”ê²Œ ë‹¤ë¦„.
- **Sequenceë¥¼ ë°›ë”ë¼ë„ ê°’ì€ í•˜ë‚˜ì”© ë‚´ë ¤ê°€ëŠ”ê²ƒì— ì£¼ì˜**
- `[3, 4].prepend[1,2] â†’ **1, 2, 3, 4**`

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%201.png)

### prepend(Publisher)

- publisherë¥¼ ì•ì— ë¶™ì¼ ìˆ˜ ìˆë‹¤.
- origin publisherì— ê°’ì´ íë¥´ì§€ ì•Šì•„ë„, prependë¡œ ë¶™ì¸ publisherê°€ ê°’ì„ í˜ë¦¬ë©´ ì´ˆê¸°ê°’ìœ¼ë¡œ ë°›ëŠ”ë‹¤.
- prependë¡œ ë¶™ì€ publisherê°€ ê°’ì„ ë°©ì¶œí•˜ì§€ì•Šê³  completionì´ ë‚¬ë”ë¼ë„ origin publisherì—ì„œ ê°’ì´ íë¥´ë©´ êµ¬ë…ìŠ¤íŠ¸ë¦¼ì— origin publisher ê°’ì´ íë¥¸ë‹¤.
- origin publisherì˜ ê°’ ë°©ì¶œ ê¸°ì¤€ì´ publisher2ì˜ completionì´ë¼ê³  ì•Œë©´ëœë‹¤. **A prepend publisher must complete!**

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%202.png)

## Appending

### append(Output)

- prependì˜ counterpart.
- **origin publisherì— `.finished` íë¥´ê³  ë‚˜ì„œì•¼ ë’¤ì— appendëœë‹¤.**
    - **.finishedê°€ ì•ˆë‚˜ë©´ origin publisherì—ì„œ ë°©ì¶œëœ ê°’ë§Œ ìŠ¤íŠ¸ë¦¼ì— íë¥¸ë‹¤.**
    
    ```swift
    example(of: "append(Output...) #2") {
      // 1
      let publisher = PassthroughSubject<Int, Never>()
    
      publisher
        .append(3, 4)
        .append(5)
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
      
      // 2
      publisher.send(1)
      publisher.send(2)
    	// ì£¼ì„ì„ í’€ë©´ - 1, 2, 3, 4, 5
    //  publisher.send(completion: .finished)
    }
    
    // ì£¼ì„ì„ ì•ˆí’€ì—ˆê¸°ì— 
    // 1, 2ë§Œ ë°©ì¶œ
    ```
    
- append ìˆœì„œëŠ” prependì™€ ë°˜ëŒ€ë¡œ ë‚˜ì¤‘ì— ë¶™ì€ê²Œ ë‚˜ì¤‘ì— append ë˜ì„œ ë‚˜ì˜¨ë‹¤.

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%203.png)

### append(Sequence)

- valueëŒ€ì‹  Sequenceë¶™ì´ê¸°
- ë™ì¼í•˜ê²Œ originì— completeê°€ í˜ëŸ¬ì•¼ append ë¨. ê·¸ ì „ê¹Œì§„ origin publisherì˜ valueë§Œ ë°©ì¶œ

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%204.png)

### append(Publisher)

- publisherë¥¼ ë¶™ì¼ ìˆ˜ ìˆìŒ. ë™ì¼í•˜ê²Œ compelte ê¸°ì¤€ìœ¼ë¡œ append.

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%205.png)

## Advanced combiningğŸŒŸ

### switchToLatest â­âœ³ï¸

- ê°€ì¥ ìµœì‹ ì˜ ê°’ì´ íë¥¸ ìŠ¤íŠ¸ë¦¼ì„ êµ¬ë… ìŠ¤ìœ„ì¹˜í•œë‹¤. ì´ì „ êµ¬ë…ì€ cancel ëœë‹¤.
- rxì˜ flatMapLatestë‘ ë¹„ìŠ¤ë¬´ë¦¬ì´ì´
- original publisherë‚˜ í˜„ì¬ êµ¬ë…ëœ publisherì— errorê°€ í•œìª½ì´ë¼ë„ ì—ëŸ¬ê°€ íë¥´ë©´ êµ¬ë… ìŠ¤íŠ¸ë¦¼ì€ complete with failure
- ***ì½”ë“œ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ Outputì´ Publisherì¼ ë•Œ ì‚¬ìš©ê°€ëŠ¥í•œ ì˜¤í¼ë ˆì´í„°!***

```swift
@available(macOS 11.0, iOS 14.0, tvOS 14.0, watchOS 7.0, *)
extension Publisher where Self.Failure == Never,
 Self.Output : Publisher, Self.Output.Failure == Never {
    public func switchToLatest() -> Publishers.SwitchToLatest<Self.Output, Self>
}
```

- ì•„ë˜ ì˜ˆì œëŠ” ìŠ¤íŠ¸ë¦¼ ì—¬ëŸ¬ ê°œ publishersë¬¶ì–´ë†“ê³  publishersì— í˜ë¦° ìµœì‹ ì˜ ìŠ¤íŠ¸ë¦¼ì„ ê°€ì§€ê³  í™•ì¸í•˜ëŠ” ì˜ˆì œ
- publishersì— completionì´ íë¥´ë”ë¼ë„ ë§ˆì§€ë§‰ìœ¼ë¡œ êµ¬ë…ëœ publisher3ì— completionì´ íë¥´ì§€ ì•Šìœ¼ë©´ completeì´ ì•ˆë‚œë‹¤. â†’ ë°˜ëŒ€ë¡œ publisher3ì— completionì´ íë¥´ë”ë¼ë„ publishersì— completionì´ ì•ˆíë¥´ë©´ not complete.
    - All active subscriptionsê°€ completeì´ ë˜ì•¼í•œë‹¤.

```swift
example(of: "switchToLatest") {
  // 1
  let publisher1 = PassthroughSubject<Int, Never>()
  let publisher2 = PassthroughSubject<Int, Never>()
  let publisher3 = PassthroughSubject<Int, Never>()

  // 2
  let publishers = PassthroughSubject<PassthroughSubject<Int, Never>, Never>()

  // 3
  publishers
    .switchToLatest()
    .sink(
        receiveCompletion: { _ in print("Completed!") },
        receiveValue: { print($0) }
    )
    .store(in: &subscriptions)

  // 4
  publishers.send(publisher1)
  publisher1.send(1)
  publisher1.send(2)

  // 5
  publishers.send(publisher2) // cancel publisher1 subscription
  publisher1.send(3) // ignored
  publisher2.send(4)
  publisher2.send(5)

  // 6
  publishers.send(publisher3) // cancel publisher2 subscription
  publisher2.send(6) // ignored
  publisher3.send(7)
  publisher3.send(8)
  publisher3.send(9)

  // 7
  publisher3.send(completion: .finished)
  publishers.send(completion: .finished)
}
/*
1
2
4
5
7
8
9
Completed!
*/
```

- ìœ ì €ê°€ ë²„íŠ¼ íƒ­ í•  ë•Œë§ˆë‹¤ API í˜¸ì¶œë¡œ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ì˜¤ëŠ” ì‹œë‚˜ë¦¬ì˜¤ ìƒ˜í”Œ. (ì¢€ ë” ëª…í™•íˆ í™•ì¸í•˜ê¸° ìœ„í•´ ì½”ë“œë¥¼ ì¡°ê¸ˆ ë°”ê¿¨ë‹¤. ë©”ì„œë“œì— tapì˜ ë²ˆí˜¸ë¥¼ ë¶™ì—¬ ë””ë²„ê¹…í•˜ê¸° í¸í•˜ë„ë¡ ìˆ˜ì •)
- 1ë²ˆì§¸ tapê³¼ 3ë²ˆì§¸ tapì— ëŒ€í•œ ì´ë¯¸ì§€ë§Œ ê°€ì ¸ì˜¨ë‹¤.
    - 2ë²ˆì§¸ tapê³¼ 3ë²ˆì§¸ tap ì‚¬ì´ì— ê°„ê²©ì´ ì§§ê¸° ë•Œë¬¸ì—, 3ë²ˆì§¸ íƒ­ìœ¼ë¡œ 2ë²ˆì§¸ êµ¬ë…ì„ cancelì‹œí‚¤ê³  3ë²ˆì§¸ ì´ë¯¸ì§€ ìš”ì²­ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë¡œê·¸ë¥¼ í†µí•´ ì•Œ ìˆ˜ ìˆë‹¤.

```swift
example(of: "switchToLatest - Network Request") {
  let url = URL(string: "https://source.unsplash.com/random")!

  // 1
    func getImage(_ number: Int) -> AnyPublisher<UIImage?, Never> {
    URLSession.shared
        .dataTaskPublisher(for: url)
        .map { data, _ in UIImage(data: data) }
        .print("image\(number)")
        .replaceError(with: nil)
        .eraseToAnyPublisher()
  }
    
  // 2
  let taps = PassthroughSubject<Int, Never>()

  taps
    .map { getImage($0) } // 3. Publisher<Publisher<UIImage?, Never>, Never>
    .switchToLatest() // 4
    .sink(receiveValue: { _ in })
    .store(in: &subscriptions)

  // 5
  taps.send(1)

  DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
    taps.send(2)
  }

  DispatchQueue.main.asyncAfter(deadline: .now() + 3.1) {
    taps.send(3)
  }
}
/*
image1: receive subscription: (DataTaskPublisher)
image1: request unlimited
image1: receive value: (Optional(<UIImage:0x600001a3c6c0 anonymous {1200, 800} renderingMode=automatic(original)>))
image1: receive finished
image2: receive subscription: (DataTaskPublisher)
image2: request unlimited

image2: receive cancel

image3: receive subscription: (DataTaskPublisher)
image3: request unlimited
image3: receive value: (Optional(<UIImage:0x600001a3c7e0 anonymous {1200, 800} renderingMode=automatic(original)>))
image3: receive finished
*/
```

3.íƒ€ì…: `Publisher<Publisher<UIImage?, Never>, Never>`

### merge(with:)

- ë‘ ê°œì˜ publisherì˜ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œë¶€í„° ì´ë²¤íŠ¸ë¥¼ ë‹¤ ë°›ìŒ.
- ë‘ ìŠ¤íŠ¸ë¦¼ ëª¨ë‘ complete ë‚˜ì•¼ êµ¬ë… ìŠ¤íŠ¸ë¦¼ì— completeì´ íë¦„.
- í•˜ì§€ë§Œ ìŠ¤íŠ¸ë¦¼ ì¤‘ì— ì—ëŸ¬ê°€ íë¥¸ë‹¤ë©´ êµ¬ë… ìŠ¤íŠ¸ë¦¼ì— complete with failure

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%206.png)

### combineLatest

- ë¬¶ì¸ publisherë“¤ì˜ ëª¨ë“  ê°’ì„ íŠœí”Œë¡œ í•©ì³ì„œ ë‚´ë ¤ì¤€ë‹¤.
- í•œìª½ì´ íë¥´ë”ë¼ë„ ì´ë¦„ì²˜ëŸ¼ ë‹¤ë¥¸ìª½ì— í˜ë €ë˜ ë§ˆì§€ë§‰ìœ¼ë¡œ í˜ë €ë˜ ê°’ì„ í•¨ê»˜ ë‚´ë ¤ì¤€ë‹¤.
- ë§ˆì°¬ê°€ì§€ë¡œ ë‘ ìŠ¤íŠ¸ë¦¼ ëª¨ë‘ completeê°€ ë˜ì•¼ ë. â†’ ì´ì¯¤ë˜ë©´ combining ìª½ì˜ operatorë“¤ì˜ complete ê·œì¹™ì€ ì•Œ ê²ƒ.

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%207.png)

### zip

- ì¸ë±ìŠ¤ë¡œ ìŒì„ ì´ë£¬ë‹¤. ë¬¶ì¸ publisherë“¤ì˜ ê°™ì€ ì¸ë±ìŠ¤ì˜ ê°’ì„ ë¬¶ì–´ì„œ ë‚´ë ¤ì¤€ë‹¤.
- ìµœëŒ€ ì¸ë±ìŠ¤ì— ë„ë‹¬í•˜ì§€ ëª»í•œ publisherê°€ ìˆë‹¤ë©´ ê¸°ë‹¤ë¦¬ê³ , ê°’ì´ ì™€ì•¼ íë¥¸ë‹¤.

![Untitled](5%20Combining%20Operators%2085ed70a164fe4fa29d1cc9d3d0d64992/Untitled%208.png)